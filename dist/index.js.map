{"version":3,"sources":["../src/index.js"],"names":["server","C2SServer","port","domain","tls","keyPath","__dirname","certPath","on","client","opts","cb","auth","findOne","username","jid","local","err","user","console","log","password","Error"],"mappings":";;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,kBAAc,cAAM;;AAEnB,MAAMA,SAAS,IAAI,yBAAKC,SAAT,CAAmB;AAC/BC,UAAM,IADyB;AAE/BC,YAAQ,SAFuB;AAG/BC,SAAK;AACHC,eAASC,YAAU,sBADhB;AAEHC,gBAAUD,YAAU;AAFjB;AAH0B,GAAnB,CAAf;;AASC,8BAAuBN,MAAvB;;AAEA;AACA,0BAASA,MAAT;AACA,0BAASA,MAAT;;AAEAA,SAAOQ,EAAP,CAAU,SAAV,EAAqB,UAASC,MAAT,EAAiB;;AAEpCA,WAAOD,EAAP,CAAU,cAAV,EAA0B,UAASE,IAAT,EAAeC,EAAf,EAAmB;AAC5C,sBAAQC,IAAR,CAAaC,OAAb,CAAqB,EAACC,UAAUJ,KAAKK,GAAL,CAASC,KAApB,EAArB,EAAiD,UAASC,GAAT,EAAcC,IAAd,EAAoB;AAClE,YAAGD,GAAH,EAAQE,QAAQC,GAAR,CAAYH,GAAZ;AACN,YAAIC,KAAKJ,QAAL,IAAiBJ,KAAKW,QAA1B,EACEV,GAAG,IAAH,EAASD,IAAT,EADF,KAGEC,GAAG,IAAIW,KAAJ,CAAU,wBAAV,CAAH;AACL,OANF;AAOA,KARD;;AAUAb,WAAOD,EAAP,CAAU,SAAV,EAAqB,YAAY;AAChCW,cAAQC,GAAR,CAAY,MAAZ;AACA,KAFD;AAID,GAhBD;AAkBD,CAnCD","file":"index.js","sourcesContent":["import xmpp from 'node-xmpp-server';\nimport ltx from 'ltx';\nimport path from 'path';\nimport morgan from 'morgan';\nimport initializeDb from './app/core/db';\nimport initializeDependencies from './app/core/dependencies';\nimport config from './app/core/config.json';\nimport Account from './app/modules/account/model';\nimport Messages from './app/modules/messages';\nimport Presence from './app/modules/presence';\n\ninitializeDb( db => {\n\n\tconst server = new xmpp.C2SServer({\n    port: 5222,\n    domain: 'warface',\n    tls: {\n      keyPath: __dirname+'/app/tls/warface.key',\n      certPath: __dirname+'/app/tls/warface.crt'\n    }\n  });\n\n  initializeDependencies(server, config);\n\n  // Modules XMPP\n  Messages(server, config);\n  Presence(server, config);\n\n  server.on(\"connect\", function(client) {\n\n    client.on(\"authenticate\", function(opts, cb) {\n    \tAccount.auth.findOne({username: opts.jid.local}, function(err, user) {\n        if(err) console.log(err);\n          if (user.username && opts.password)\n            cb(null, opts);\n          else\n            cb(new Error(\"Authentication failure\"));\n      });\n    });\n\n    client.on('offline', function () {\n    \tconsole.log('saiu');\n    });\n\n  });\n\t\n});"]}