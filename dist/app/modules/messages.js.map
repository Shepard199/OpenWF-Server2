{"version":3,"sources":["../../../src/app/modules/messages.js"],"names":["server","config","on","client","stz","auth","findOne","username","jid","user","err","is","query","getChild","children","message","parse","attrs","to","nickname","from","send"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe,UAACA,MAAD,EAASC,MAAT,EAAoB;AAC/BD,WAAOE,EAAP,CAAU,SAAV,EAAqB,UAASC,MAAT,EAAiB;AAClCA,eAAOD,EAAP,CAAU,QAAV,EAAoB,UAASE,GAAT,EAAc;AAC9B,4BAAQC,IAAR,CAAaC,OAAb,CAAqB,EAACC,UAAUJ,OAAOK,GAAP,CAAWC,IAAtB,EAArB,EAAkD,UAASC,GAAT,EAAcD,IAAd,EAAoB;AAClE,oBAAIL,IAAIO,EAAJ,CAAO,SAAP,CAAJ,EAAuB;AACnB,wBAAIC,QAAQR,IAAIS,QAAJ,CAAa,MAAb,EAAqBC,QAArB,CAA8B,CAA9B,CAAZ;AACA,wBAAIC,UAAU,cAAIC,KAAJ,CACV,oBAAkBZ,IAAIa,KAAJ,CAAUC,EAA5B,GAA+B,GAA/B,GAAmCT,KAAKU,QAAxC,GAAiD,QAAjD,GAA0Df,IAAIa,KAAJ,CAAUG,IAApE,GAAyE,qBAAzE,GACI,QADJ,GACaR,KADb,GACmB,SADnB,GAEA,YAHU,CAAd;AAIAT,2BAAOkB,IAAP,CAAYN,OAAZ;AACH;AACJ,aATD;AAUH,SAXD;AAYH,KAbD;AAcH,C","file":"messages.js","sourcesContent":["import Account from './account/model';\nimport xmpp from 'node-xmpp-server';\nimport ltx from 'ltx';\n\nexport default (server, config) => {\n    server.on('connect', function(client) {\n        client.on('stanza', function(stz) {\n            Account.auth.findOne({username: client.jid.user}, function(err, user) {\n                if (stz.is('message')) {\n                    let query = stz.getChild('body').children[0];\n                    let message = ltx.parse(\n                        \"<message from='\"+stz.attrs.to+\"/\"+user.nickname+\"' to='\"+stz.attrs.from+\"' type='groupchat'>\"+\n                            \"<body>\"+query+\"</body>\"+\n                        \"</message>\");\n                    client.send(message);\n                }\n            });\n        });\n    });\n};\n\n"]}