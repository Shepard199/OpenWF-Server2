{"version":3,"sources":["../../../../src/app/xmpp/gameroom/gameroomopen.js"],"names":["guidGenerator","S4","Math","random","toString","substring","getPlayers","obj","array","i","length","profile_id","team_id","status","observer","skill","nickname","clanName","class_id","online_id","group_id","presence","experience","rank","banner_badge","banner_mark","banner_stripe","region_id","getTeamColors","id","color","getObjective","list","type","getCrownRewardsThresholds","bronze","silver","gold","parseXMLModel","get1","get2","get3","get4","get5","mission_key","no_teams","name","setting","mode","mode_name","mode_icon","description","image","difficulty","time_of_day","objectives","factor","crownrewardsthresholds","crownrewards","getMission","key","cb","missions","findOne","err","mission","client","stz","query","profile","username","jid","user","GameRoom","gameroomopen","room_id","room_type","jid_created","core","teams_switched","room_name","private","players","can_start","team_balanced","auto_team_balance","min_ready_players","max_players","revision","profileid","session","game_progress","start_time","custom_params","friendly_fire","enemy_outlines","dead_can_chat","join_in_the_process","round_limit","class_restriction","inventory_slot","kick_vote_params","success","timeout","cooldown","room_master","master","save","mission_pl","parse","attrs","from","to","team_colors","send"],"mappings":"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","file":"gameroomopen.js","sourcesContent":["import Account from '../../modules/account/model';\nimport xmpp from 'node-xmpp-server';\nimport ltx from 'ltx';\n\nfunction guidGenerator() {\n    let S4 = function() {\n       return (((1+Math.random())*0x10000)|0).toString(16).substring(1);\n    };\n    return (S4()+S4()+\"\"+S4()+\"\"+S4()+\"\"+S4()+\"\"+S4()+S4()+S4());\n}\n\nfunction getPlayers(obj){\n    \n    let array =  '';\n    for (var i = 0; i < obj.length; i++) {\n        array += \"<player profile_id='\"+obj[i].profile_id+\"' team_id='\"+obj[i].team_id+\"' status='\"+obj[i].status+\"' observer='\"+obj[i].observer+\"' skill='\"+obj[i].skill+\"' nickname='\"+obj[i].nickname+\"' clanName='\"+obj[i].clanName+\"' class_id='\"+obj[i].class_id+\"' online_id='\"+obj[i].online_id+\"' group_id='\"+obj[i].group_id+\"' presence='\"+obj[i].presence+\"' experience='\"+obj[i].experience+\"' rank='\"+obj[i].rank+\"' banner_badge='\"+obj[i].banner_badge+\"' banner_mark='\"+obj[i].banner_mark+\"' banner_stripe='\"+obj[i].banner_stripe+\"' region_id='\"+obj[i].region_id+\"'/>\";\n    }\n    return array;\n\n}\n\nfunction getTeamColors(obj){\n    \n    let array =  '';\n    for (var i = 0; i < obj.length; i++) {\n        array += \"<team_color id='\"+obj[i].id+\"' color='\"+obj[i].color+\"'/>\";\n    }\n    return array;\n\n}\n\nfunction getObjective(obj){\n    let list = '';\n    for (var i = 0; i < obj.length; i++) {\n        list += \"<objective id='\"+obj[i].id+\"' type='\"+obj[i].type+\"'/>\";\n    }\n    return list;\n}\n\nfunction getCrownRewardsThresholds(obj){\n    let list = '';\n    if(obj['totalperformance']){\n        list += \"<TotalPerformance bronze='\"+obj['totalperformance'].bronze+\"' silver='\"+obj['totalperformance'].silver+\"' gold='\"+obj['totalperformance'].gold+\"'/>\";\n    }else if(obj['time']){\n        list += \"<Time bronze='\"+obj['time'].bronze+\"' silver='\"+obj['time'].silver+\"' gold='\"+obj['time'].gold+\"'/>\";\n    }\n    return list;\n}\n\nfunction parseXMLModel(i){\n    \n    var get1,\n        get2 = \"\",\n        get3 = \"\",\n        get4 = \"\",\n        get5;\n\n    get1 = \"<mission mission_key='\"+i.mission_key+\"' no_teams='\"+i.no_teams+\"' name='\"+i.name+\"' setting='\"+i.setting+\"' mode='\"+i.mode+\"' mode_name='\"+i.mode_name+\"' mode_icon='\"+i.mode_icon+\"' description='\"+i.description+\"' image='\"+i.image+\"' difficulty='\"+i.difficulty+\"' type='\"+i.type+\"' time_of_day='\"+i.time_of_day+\"'>\";\n    \n        if(i.objectives.length > 0){\n           get2 = \"<objectives factor='\"+i.objectives.factor+\"'>\"+getObjective(i.objectives.obj)+\"</objectives>\";\n        }\n\n        if(i.crownrewardsthresholds.length > 0){\n            get3 = \"<CrownRewardsThresholds>\"+getCrownRewardsThresholds(i.crownrewardsthresholds)+\"</CrownRewardsThresholds>\";\n        }\n\n        if(i.crownrewards.length > 0){\n            get4 = \"<CrownRewards bronze='\"+i.crownrewards.bronze+\"' silver='\"+i.crownrewards.silver+\"' gold='\"+i.crownrewards.gold+\"'/>\";\n        }\n\n    get5 = \"</mission>\";\n\n    return get1 + get2 + get3 + get4 + get5;\n\n}\n\nfunction getMission(key, cb){\n    Account.missions.findOne({mission_key: key}, function(err, mission) {\n        cb(parseXMLModel(mission));\n    });\n}\n\nexport default (client, stz, query) => {\n    Account.profile.findOne({username: client.jid.user}, function(err, user) {\n\n        let GameRoom = new Account.gameroomopen({\n            room_id: guidGenerator(),\n            room_type: query.room_type,\n            jid_created: client.jid.user+'@warface/GameClient',\n            core: {\n                teams_switched: '0',\n                room_name: query.room_name,\n                private: query.private,\n                players: '1',\n                can_start: '0',\n                team_balanced: query.auto_team_balance,\n                min_ready_players: query.max_players,\n                revision: '2',\n                players: [\n                    {\n                        profile_id: user.profileid,\n                        team_id: query.team_id,\n                        status: query.status,\n                        observer: '0',\n                        skill: '0',\n                        nickname: user.nickname,\n                        clanName: 'Privado',\n                        class_id: query.class_id,\n                        online_id: client.jid.user+'@warface/GameClient',\n                        group_id: query.group_id,\n                        presence: '17',\n                        experience: user.experience,\n                        rank: '55',\n                        banner_badge: user.banner_badge,\n                        banner_mark: user.banner_mark,\n                        banner_stripe: user.banner_stripe,\n                        region_id: 'global'\n                }],\n                team_colors: [\n                    {id: '1', color: '4294907157'},\n                    {id: '2', color: '4279655162'}\n                ]\n            },\n            session: {\n                id: '',\n                status: query.status,\n                game_progress: '0',\n                start_time: '18446744011573962016',\n                revision:  '2'\n            },\n            custom_params: {\n                friendly_fire: query.friendly_fire,\n                enemy_outlines: query.enemy_outlines,\n                auto_team_balance: query.auto_team_balance,\n                dead_can_chat: '1',\n                join_in_the_process: '1',\n                max_players: query.max_players,\n                round_limit: query.round_limit,\n                class_restriction: '253',\n                inventory_slot: query.inventory_slot,\n                revision: '2'\n            },\n            mission:{\n                mission_key: query.mission,\n            },\n            kick_vote_params: {\n                success: '0.8',\n                timeout: '60',\n                cooldown: '300',\n                revision: '1'\n            },\n            room_master: {\n                master: user.profileid,\n                revision: '2'\n            }\n        });\n\n        GameRoom.save(function(err) {\n            \n            getMission(GameRoom.mission.mission_key, function(mission_pl) {\n\n                let gameroomopen = ltx.parse(\n                    \n                    \"<iq to='\"+stz.attrs.from+\"' from='\"+stz.attrs.to+\"' id='\"+stz.attrs.id+\"' type='result'>\"+\n                        \"<query xmlns='urn:cryonline:k01'>\"+\n                            \"<gameroom_open>\"+\n                                \"<game_room room_id='\"+GameRoom.room_id+\"' room_type='\"+GameRoom.room_type+\"'>\"+\n            \n                                    \"<core teams_switched='\"+GameRoom.core.teams_switched+\"' room_name='\"+GameRoom.core.room_name+\"' private='\"+GameRoom.core.private+\"' players='\"+GameRoom.core.players+\"' can_start='\"+GameRoom.core.can_start+\"' team_balanced='\"+GameRoom.core.team_balanced+\"' min_ready_players='\"+GameRoom.core.min_ready_players+\"' revision='\"+GameRoom.core.revision+\"'>\"+\n                                        \n                                        \"<players>\"+\n                                           getPlayers(GameRoom.core.players)+\n                                        \"</players>\"+\n\n                                        \"<playersReserved/>\"+\n                                        \n                                        \"<team_colors>\"+\n                                            getTeamColors(GameRoom.core.team_colors)+\n                                        \"</team_colors>\"+\n\n                                    \"</core>\"+\n\n\n                                    \"<session id='\"+GameRoom.session.id+\"' status='\"+GameRoom.session.status+\"' game_progress='\"+GameRoom.session.game_progress+\"' start_time='\"+GameRoom.session.start_time+\"' revision='\"+GameRoom.session.revision+\"'/>\"+\n                                    \n                                    \"<custom_params friendly_fire='\"+GameRoom.custom_params.friendly_fire+\"' enemy_outlines='\"+GameRoom.custom_params.enemy_outlines+\"' auto_team_balance='\"+GameRoom.custom_params.auto_team_balance+\"' dead_can_chat='\"+GameRoom.custom_params.dead_can_chat+\"' join_in_the_process='\"+GameRoom.custom_params.join_in_the_process+\"' max_players='\"+GameRoom.custom_params.max_players+\"' round_limit='\"+GameRoom.custom_params.round_limit+\"' class_restriction='\"+GameRoom.custom_params.class_restriction+\"' inventory_slot='\"+GameRoom.custom_params.inventory_slot+\"' revision='\"+GameRoom.custom_params.revision+\"'/>\"+\n                                    \n                                    mission_pl+\n\n                                    \"<kick_vote_params success='\"+GameRoom.kick_vote_params.success+\"' timeout='\"+GameRoom.kick_vote_params.timeout+\"' cooldown='\"+GameRoom.kick_vote_params.cooldown+\"' revision='\"+GameRoom.kick_vote_params.revision+\"'/>\"+\n                                    \"<room_master master='\"+GameRoom.room_master.master+\"' revision='\"+GameRoom.room_master.revision+\"'/>\"+\n\n                                \"</game_room>\"+\n                            \"</gameroom_open>\"+\n                        \"</query>\"+\n                    \"</iq>\")\n\n                client.send(gameroomopen)\n           \n            });\n\n        });\n\n    });\n    \n};"]}