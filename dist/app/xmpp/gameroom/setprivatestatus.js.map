{"version":3,"sources":["../../../../src/app/xmpp/gameroom/setprivatestatus.js"],"names":["client","stz","query","getPlayers","obj","array","i","length","online_id","attrs","from","profile_id","team_id","status","observer","skill","nickname","clanName","class_id","group_id","presence","experience","rank","banner_badge","banner_mark","banner_stripe","region_id","gameroomopen","findOne","$elemMatch","err","res","setprivatestatus","parse","to","id","room_id","room_type","core","teams_switched","room_name","private","players","can_start","team_balanced","min_ready_players","revision","room_master","master","send","sort","_id"],"mappings":"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","file":"setprivatestatus.js","sourcesContent":["import Account from '../../modules/account/model';\nimport xmpp from 'node-xmpp-server';\nimport ltx from 'ltx';\n\nexport default (client, stz, query) => {\n\n\n\tfunction getPlayers(obj){\n    \n\t    let array =  '';\n\t    for (var i = 0; i < obj.length; i++) {\n\t    \tif(obj[i].online_id === stz.attrs.from){\n\t    \t\tarray += \"<player profile_id='\"+obj[i].profile_id+\"' team_id='\"+obj[i].team_id+\"' status='\"+obj[i].status+\"' observer='\"+obj[i].observer+\"' skill='\"+obj[i].skill+\"' nickname='\"+obj[i].nickname+\"' clanName='\"+obj[i].clanName+\"' class_id='\"+obj[i].class_id+\"' online_id='\"+obj[i].online_id+\"' group_id='\"+obj[i].group_id+\"' presence='\"+obj[i].presence+\"' experience='\"+obj[i].experience+\"' rank='\"+obj[i].rank+\"' banner_badge='\"+obj[i].banner_badge+\"' banner_mark='\"+obj[i].banner_mark+\"' banner_stripe='\"+obj[i].banner_stripe+\"' region_id='\"+obj[i].region_id+\"'/>\";\n\t    \t}else{\n\t    \t\tarray += \"<player profile_id='\"+obj[i].profile_id+\"' team_id='\"+obj[i].team_id+\"' status='\"+obj[i].status+\"' observer='\"+obj[i].observer+\"' skill='\"+obj[i].skill+\"' nickname='\"+obj[i].nickname+\"' clanName='\"+obj[i].clanName+\"' class_id='\"+obj[i].class_id+\"' online_id='\"+obj[i].online_id+\"' group_id='\"+obj[i].group_id+\"' presence='\"+obj[i].presence+\"' experience='\"+obj[i].experience+\"' rank='\"+obj[i].rank+\"' banner_badge='\"+obj[i].banner_badge+\"' banner_mark='\"+obj[i].banner_mark+\"' banner_stripe='\"+obj[i].banner_stripe+\"' region_id='\"+obj[i].region_id+\"'/>\";\n\t    \t}\n\t    }\n\t    return array;\n\n\t}\n\n\tAccount.gameroomopen.findOne({'core.players': {$elemMatch: {online_id: stz.attrs.from}}}, function(err, res) {\n  \t\t\n\t\tlet setprivatestatus = ltx.parse(\n            \"<iq to='\"+stz.attrs.from+\"' from='\"+stz.attrs.to+\"' id='\"+stz.attrs.id+\"' type='get'>\"+\n                \"<query xmlns='urn:cryonline:k01'>\"+\n                \t\"<gameroom_setprivatestatus>\"+\n\t\t\t\t\t\t\"<game_room room_id='\"+res.room_id+\"' room_type='\"+res.room_type+\"'>\"+\n\t\t\t\t\t\t\t\"<core teams_switched='\"+res.core.teams_switched+\"' room_name='\"+res.core.room_name+\"' private='\"+query.private+\"' players='\"+res.core.players+\"' can_start='\"+res.core.can_start+\"' team_balanced='\"+res.core.team_balanced+\"' min_ready_players='\"+res.core.min_ready_players+\"' revision='\"+res.core.revision+\"'>\"+\n\t\t\t\t\t\t\t\t\"<players>\"+\n\t\t\t\t\t\t\t\t\tgetPlayers(res.core.players)+\n\t\t\t\t\t\t\t\t\"</players>\"+\n\t\t\t\t\t\t\t\t\"<playersReserved/>\"+\n\t\t\t\t\t\t\t\"</core>\"+\n\t\t\t\t\t\t\t\"<room_master master='\"+res.room_master.master+\"' revision='\"+res.room_master.revision+\"'/>\"+\n\t\t\t\t\t\t\"</game_room>\"+\n\t\t\t\t\t\"</gameroom_setprivatestatus>\"+\n                \"</query>\"+\n            \"</iq>\")\n        client.send(setprivatestatus)\n\n\n\t}).sort({_id:1});\n}"]}