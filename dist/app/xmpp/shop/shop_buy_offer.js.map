{"version":3,"sources":["../../../../src/app/xmpp/shop/shop_buy_offer.js"],"names":["moneyNew","money","item","parseInt","client","stz","query","profile","findOne","username","jid","user","err","items","offer_id","shop_buy_offer","parse","attrs","from","to","id","name","expirationTime","quantity","game_money","game_price","cry_money","cry_price","crown_money","crown_price","send"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,SAASA,QAAT,CAAkBC,KAAlB,EAAyBC,IAAzB,EAA8B;AAC1B,WAAOC,SAASF,QAAQC,IAAjB,CAAP;AACH;;kBAEc,UAACE,MAAD,EAASC,GAAT,EAAcC,KAAd,EAAwB;AACnC,oBAAQC,OAAR,CAAgBC,OAAhB,CAAwB,EAACC,UAAUL,OAAOM,GAAP,CAAWC,IAAtB,EAAxB,EAAqD,UAASC,GAAT,EAAcD,IAAd,EAAoB;AACrE,wBAAKE,KAAL,CAAWL,OAAX,CAAmB,EAAC,WAAWF,MAAMQ,QAAlB,EAAnB,EAAgD,UAASF,GAAT,EAAcC,KAAd,EAAqB;;AAEjE,gBAAIE,iBAAiB,cAAIC,KAAJ,CACjB,aAAWX,IAAIY,KAAJ,CAAUC,IAArB,GAA0B,UAA1B,GAAqCb,IAAIY,KAAJ,CAAUE,EAA/C,GAAkD,QAAlD,GAA2Dd,IAAIY,KAAJ,CAAUG,EAArE,GAAwE,kBAAxE,GACI,mCADJ,GAEQ,4BAFR,GAEqCd,MAAMQ,QAF3C,GAEoD,qBAFpD,GAIY,kBAJZ,GAKgB,sBALhB,GAKuCD,MAAMX,IAAN,CAAWmB,IALlD,GAKuD,qBALvD,GAK6ER,MAAMX,IAAN,CAAWkB,EALxF,GAK2F,aAL3F,GAKyGP,MAAMX,IAAN,CAAWkB,EALpH,GAKuH,sBALvH,GAK8IP,MAAMX,IAAN,CAAWoB,cALzJ,GAKwK,oBALxK,GAK6LT,MAAMX,IAAN,CAAWqB,QALxM,GAKiN,qBALjN,GAMoB,YANpB,GAMiCV,MAAMX,IAAN,CAAWkB,EAN5C,GAM+C,UAN/C,GAM0DP,MAAMX,IAAN,CAAWmB,IANrE,GAM0E,yLAN1E,GAOgB,iBAPhB,GAQY,mBARZ,GAUY,qBAVZ,GAUkCrB,SAASW,KAAKa,UAAd,EAA0BX,MAAMX,IAAN,CAAWuB,UAArC,CAVlC,GAUmF,eAVnF,GAUmGzB,SAASW,KAAKe,SAAd,EAAyBb,MAAMX,IAAN,CAAWyB,SAApC,CAVnG,GAUkJ,iBAVlJ,GAUoK3B,SAASW,KAAKiB,WAAd,EAA2Bf,MAAMX,IAAN,CAAW2B,WAAtC,CAVpK,GAUuN,KAVvN,GAYQ,mBAZR,GAaI,UAbJ,GAcA,OAfiB,CAArB;AAiBAzB,mBAAO0B,IAAP,CAAYf,cAAZ;AAEH,SArBD;AAsBH,KAvBD;AAwBH,C;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"shop_buy_offer.js","sourcesContent":["import Account from '../../modules/account/model';\nimport Shop from '../../modules/shop/model';\nimport ltx from 'ltx';\n\nfunction moneyNew(money, item){\n    return parseInt(money - item);\n}\n\nexport default (client, stz, query) => {\n    Account.profile.findOne({username: client.jid.user}, function(err, user) {\n        Shop.items.findOne({'item.id': query.offer_id}, function(err, items) {\n\n            let shop_buy_offer = ltx.parse(\n                \"<iq to='\"+stz.attrs.from+\"' from='\"+stz.attrs.to+\"' id='\"+stz.attrs.id+\"' type='result'>\"+\n                    \"<query xmlns='urn:cryonline:k01'>\"+\n                        \"<shop_buy_offer offer_id='\"+query.offer_id+\"' error_status='0'>\"+\n                            \n                            \"<purchased_item>\"+\n                                \"<profile_item name='\"+items.item.name+\"' profile_item_id='\"+items.item.id+\"' offerId='\"+items.item.id+\"' added_expiration='\"+items.item.expirationTime+\"' added_quantity='\"+items.item.quantity+\"' error_status='0'>\"+\n                                    \"<item id='\"+items.item.id+\"' name='\"+items.item.name+\"' attached_to='0' config='' slot='0' equipped='0' default='0' permanent='1' expired_confirmed='0' buy_time_utc='1466427941' total_durability_points='36000' durability_points='36000'/>\"+\n                                \"</profile_item>\"+\n                            \"</purchased_item>\"+\n\n                            \"<money game_money='\"+moneyNew(user.game_money, items.item.game_price)+\"' cry_money='\"+moneyNew(user.cry_money, items.item.cry_price)+\"' crown_money='\"+moneyNew(user.crown_money, items.item.crown_price)+\"'/>\"+\n\n                        \"</shop_buy_offer>\"+\n                    \"</query>\"+\n                \"</iq>\"\n            )\n            client.send(shop_buy_offer);\n\n        }); \n    });\n};\n\n// let shop_buy_offer = ltx.parse(\n//         \"<iq to='\"+stz.attrs.from+\"' from='\"+stz.attrs.to+\"' id='\"+stz.attrs.id+\"' type='result'>\"+\n//             \"<query xmlns='urn:cryonline:k01'>\"+\n//                 \"<shop_buy_offer offer_id='8000' error_status='0'>\"+\n//                     \"<purchased_item>\"+\n//                         \"<profile_item name='shg11_shop' profile_item_id='121783327' offerId='12' added_expiration='0' added_quantity='0' error_status='0'>\"+\n//                             \"<item id='121783327' name='shg11_shop' attached_to='0' config='' slot='0' equipped='0' default='0' permanent='1' expired_confirmed='0' buy_time_utc='1466427941' total_durability_points='36000' durability_points='36000'/>\"+\n//                         \"</profile_item>\"+\n//                     \"</purchased_item>\"+\n//                     \"<money game_money='1000000' cry_money='245000' crown_money='100000'/>\"+\n//                 \"</shop_buy_offer>\"+\n//             \"</query>\"+\n//         \"</iq>\"\n//     )\n//     client.send(shop_buy_offer);"]}