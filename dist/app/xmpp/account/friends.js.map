{"version":3,"sources":["../../../../src/app/xmpp/account/friends.js"],"names":["arrayFriends","parseXML","fri","friendsList","i","length","all","profile","user","username","profileid","nickname","experience","getFriend","id","cb","friends","find","my_profile_id","err","findOne","to_profile_id","auth","push","setTimeout","client","stz","jid","friends_list","parse","attrs","to","from","send"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,IAAIA,eAAe,EAAnB;;AAEA,SAASC,QAAT,CAAkBC,GAAlB,EAAsB;AACpB,MAAIC,cAAc,EAAlB;AACA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,IAAIG,MAAxB,EAAgCD,GAAhC,EAAqC;AACnC,QAAGF,IAAIE,CAAJ,CAAH,EAAU;AACR,UAAGF,IAAIE,CAAJ,EAAOE,GAAP,CAAW,CAAX,EAAcC,OAAjB,EAAyB;AACvBJ,uBAAe,kBAAgBD,IAAIE,CAAJ,EAAOE,GAAP,CAAW,CAAX,EAAcE,IAAd,CAAmBC,QAAnC,GAA4C,mCAA5C,GAAgFP,IAAIE,CAAJ,EAAOE,GAAP,CAAW,CAAX,EAAcC,OAAd,CAAsBG,SAAtG,GAAgH,cAAhH,GAA+HR,IAAIE,CAAJ,EAAOE,GAAP,CAAW,CAAX,EAAcC,OAAd,CAAsBI,QAArJ,GAA8J,2BAA9J,GAA0LT,IAAIE,CAAJ,EAAOE,GAAP,CAAW,CAAX,EAAcC,OAAd,CAAsBK,UAAhN,GAA2N,iBAA1O;AACD;AACF;AACF;AACD,SAAOT,WAAP;AACD;;AAED,SAASU,SAAT,CAAmBC,EAAnB,EAAuBC,EAAvB,EAA0B;AACxB,kBAAQC,OAAR,CAAgBC,IAAhB,CAAqB,EAACC,eAAeJ,EAAhB,EAArB,EAA0C,UAASK,GAAT,EAAcjB,GAAd,EAAmB;AAAA,+BAElDE,CAFkD;AAGzD,sBAAQG,OAAR,CAAgBa,OAAhB,CAAwB,EAACV,WAAWR,IAAIE,CAAJ,EAAOiB,aAAnB,EAAxB,EAA2D,UAASF,GAAT,EAAcZ,OAAd,EAAuB;AAChF,wBAAQe,IAAR,CAAaF,OAAb,CAAqB,EAACV,WAAWR,IAAIE,CAAJ,EAAOiB,aAAnB,EAArB,EAAwD,UAASF,GAAT,EAAcX,IAAd,EAAoB;AAC1E,cAAGA,QAAQD,YAAY,IAAvB,EAA4B;AAC1BP,yBAAauB,IAAb,CAAkB,EAACjB,KAAK,CAAE,EAACC,SAASA,OAAV,EAAF,EAAsB,EAACC,MAAMA,IAAP,EAAtB,CAAN,EAAlB;AACD;AACF,SAJD;AAKD,OAND;AAHyD;;AAE3D,SAAK,IAAIJ,IAAI,CAAb,EAAgBA,IAAIF,IAAIG,MAAxB,EAAgCD,GAAhC,EAAqC;AAAA,YAA5BA,CAA4B;AAQpC;;AAEDoB,eAAW,YAAU;AACnBT,SAAGd,SAASD,YAAT,CAAH;AACD,KAFD,EAEG,GAFH;AAID,GAhBD;AAiBD;;kBAEc,UAACyB,MAAD,EAASC,GAAT,EAAiB;AAC/B,kBAAQnB,OAAR,CAAgBa,OAAhB,CAAwB,EAACX,UAAUgB,OAAOE,GAAP,CAAWnB,IAAtB,EAAxB,EAAqD,UAASW,GAAT,EAAcX,IAAd,EAAoB;AACpEK,cAAUL,KAAKE,SAAf,EAA0B,UAASkB,YAAT,EAAsB;;AAE1C,UAAIZ,UAAU,cAAIa,KAAJ,CACV,eAAaH,IAAII,KAAJ,CAAUC,EAAvB,GAA0B,QAA1B,GAAmCL,IAAII,KAAJ,CAAUE,IAA7C,GAAkD,QAAlD,GAA2DN,IAAII,KAAJ,CAAUhB,EAArE,GAAwE,eAAxE,GACI,mCADJ,GAEQ,eAFR,GAGYc,YAHZ,GAIQ,gBAJR,GAKI,UALJ,GAMA,OAPU,CAAd;AAQAH,aAAOQ,IAAP,CAAYjB,OAAZ;AACAhB,qBAAe,EAAf;AAEL,KAbD;AAcJ,GAfD;AAgBA,C","file":"friends.js","sourcesContent":["import Account from '../../modules/account/model';\nimport xmpp from 'node-xmpp-server';\nimport ltx from 'ltx';\n\nlet arrayFriends = [];\n\nfunction parseXML(fri){\n  let friendsList = '';\n  for (let i = 0; i < fri.length; i++) {\n    if(fri[i]){\n      if(fri[i].all[0].profile){\n        friendsList += \"<friend jid='\"+fri[i].all[1].user.username+\"@warface/GameClient' profile_id='\"+fri[i].all[0].profile.profileid+\"' nickname='\"+fri[i].all[0].profile.nickname+\"' status='0' experience='\"+fri[i].all[0].profile.experience+\"' location=''/>\";\n      }\n    }\n  }\n  return friendsList;\n}\n\nfunction getFriend(id, cb){\n  Account.friends.find({my_profile_id: id}, function(err, fri) {\n    \n    for (let i = 0; i < fri.length; i++) {\n      Account.profile.findOne({profileid: fri[i].to_profile_id}, function(err, profile) {\n        Account.auth.findOne({profileid: fri[i].to_profile_id}, function(err, user) {\n          if(user || profile !== null){\n            arrayFriends.push({all: [ {profile: profile}, {user: user} ]});\n          }\n        });\n      });\n    }\n\n    setTimeout(function(){\n      cb(parseXML(arrayFriends));\n    }, 200)\n\n  });\n}\n\nexport default (client, stz) => {\n\tAccount.profile.findOne({username: client.jid.user}, function(err, user) {\n      getFriend(user.profileid, function(friends_list){\n\n            let friends = ltx.parse(\n                \"<iq from='\"+stz.attrs.to+\"' to='\"+stz.attrs.from+\"' id='\"+stz.attrs.id+\"' type='get'>\"+\n                    \"<query xmlns='urn:cryonline:k01'>\"+\n                        \"<friend_list>\"+\n                            friends_list+\n                        \"</friend_list>\"+\n                    \"</query>\"+\n                \"</iq>\");\n            client.send(friends);\n            arrayFriends = [];\n\n      });\n\t});\n};"]}