{"version":3,"sources":["../../../../src/app/xmpp/missions/missions.js"],"names":["getObjective","obj","list","i","length","id","type","getCrownRewardsThresholds","bronze","silver","gold","parseXMLModel","get1","get2","get3","get4","get5","mission_key","no_teams","name","setting","mode","mode_name","mode_icon","description","image","difficulty","time_of_day","objectives","factor","crownrewardsthresholds","crownrewards","getMissions","client","cb","missions","find","err","mission","stz","auth","findOne","username","jid","user","profile","parse","attrs","from","to","send"],"mappings":"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","file":"missions.js","sourcesContent":["import Account from '../../modules/account/model';\nimport xmpp from 'node-xmpp-server';\nimport ltx from 'ltx';\n\nfunction getObjective(obj){\n    let list = '';\n    for (var i = 0; i < obj.length; i++) {\n        list += \"<objective id='\"+obj[i].id+\"' type='\"+obj[i].type+\"'/>\";\n    }\n    return list;\n}\n\nfunction getCrownRewardsThresholds(obj){\n    let list = '';\n    if(obj['totalperformance']){\n        list += \"<TotalPerformance bronze='\"+obj['totalperformance'].bronze+\"' silver='\"+obj['totalperformance'].silver+\"' gold='\"+obj['totalperformance'].gold+\"'/>\";\n    }else if(obj['time']){\n        list += \"<Time bronze='\"+obj['time'].bronze+\"' silver='\"+obj['time'].silver+\"' gold='\"+obj['time'].gold+\"'/>\";\n    }\n    return list;\n}\n\nfunction parseXMLModel(i){\n    \n    var get1,\n        get2,\n        get3,\n        get4,\n        get5;\n\n    get1 = \"<mission mission_key='\"+i.mission_key+\"' no_teams='\"+i.no_teams+\"' name='\"+i.name+\"' setting='\"+i.setting+\"' mode='\"+i.mode+\"' mode_name='\"+i.mode_name+\"' mode_icon='\"+i.mode_icon+\"' description='\"+i.description+\"' image='\"+i.image+\"' difficulty='\"+i.difficulty+\"' type='\"+i.type+\"' time_of_day='\"+i.time_of_day+\"'>\";\n    \n        if(i.objectives.length > 0){\n           get2 = \"<objectives factor='\"+i.objectives.factor+\"'>\"+getObjective(i.objectives.obj)+\"</objectives>\";\n        }\n\n        if(i.crownrewardsthresholds.length > 0){\n            get3 = \"<CrownRewardsThresholds>\"+getCrownRewardsThresholds(i.crownrewardsthresholds)+\"</CrownRewardsThresholds>\";\n        }\n\n        if(i.crownrewards.length > 0){\n            get4 = \"<CrownRewards bronze='\"+i.crownrewards.bronze+\"' silver='\"+i.crownrewards.silver+\"' gold='\"+i.crownrewards.gold+\"'/>\";\n        }\n\n    get5 = \"</mission>\";\n\n    return get1 + get2 + get3 + get4 + get5;\n\n}\n\nfunction getMissions(client, cb){\n    Account.missions.find({}, function(err, mission) {\n        let list = '';\n        for (let i = 0; i < mission.length; i++) {\n            list += parseXMLModel(mission[i]);\n        }\n        cb(list);\n    });\n}\n\nexport default (client, stz) => {\n\tAccount.auth.findOne({username: client.jid.user}, function(err, user) {\n        \n        getMissions(client, function (missions){\n            \n            let profile = ltx.parse(\n                \"<iq to='\"+stz.attrs.from+\"' from='\"+stz.attrs.to+\"' id='\"+stz.attrs.id+\"' type='result'>\"+\n                    \"<query xmlns='urn:cryonline:k01'>\"+\n                        \"<missions_get_list hash='-1430220480' content_hash='-1162631100'>\"+\n                            missions+\n                        \"</missions_get_list>\"+\n                    \"</query>\"+\n                \"</iq>\"\n            )\n\n            client.send(profile)\n            \n        });\n\t});\n};"]}